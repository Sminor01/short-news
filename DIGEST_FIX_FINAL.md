# ‚úÖ –î–∞–π–¥–∂–µ—Å—Ç—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã!

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞–ª–∏—Å—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –¥–∞—Ç—ã `date_from` –∏ `date_to` —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ –º–∏–∫—Ä–æ—Å–µ–∫—É–Ω–¥—ã, –≤–º–µ—Å—Ç–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –æ—Ç 00:00 –¥–æ 23:59.

**–ü—Ä–∏–º–µ—Ä:**
```json
{
  "date_from": "2025-10-14T17:33:38.417330",
  "date_to": "2025-10-14T17:33:38.417330",  // –û–¥–∏–Ω–∞–∫–æ–≤—ã–µ!
  "news_count": 0
}
```

## –ü—Ä–∏—á–∏–Ω–∞

–£ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ –±—ã–ª–æ –∑–∞–ø–∏—Å–∏ `user_preferences` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö. –ö–æ–≥–¥–∞ preferences –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç, –≤—ã–∑—ã–≤–∞–ª—Å—è –º–µ—Ç–æ–¥ `_empty_digest()`, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–ª —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –æ–±–µ–∏—Ö –¥–∞—Ç.

## –†–µ—à–µ–Ω–∏–µ

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ preferences

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ –¥–∞–π–¥–∂–µ—Å—Ç–∞ preferences —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:

```python
user_prefs = UserPreferences(
    timezone='UTC',
    week_start_day=0,  # Sunday
    digest_enabled=True,
    # ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
)
```

### 2. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–∞—Ç

**Daily Digest:**
- –°–æ–±–∏—Ä–∞–µ—Ç –Ω–æ–≤–æ—Å—Ç–∏ —Å 00:00:00 –¥–æ 23:59:59 —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è
- –ü—Ä–∏–º–µ—Ä: 14.10.2025 00:00 - 14.10.2025 23:59

**Weekly Digest:**
- –°–æ–±–∏—Ä–∞–µ—Ç –Ω–æ–≤–æ—Å—Ç–∏ –∑–∞ —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é (–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ - —Å—É–±–±–æ—Ç–∞)
- –ü—Ä–∏–º–µ—Ä: 12.10.2025 00:00 - 18.10.2025 23:59

### 3. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤

–î–∞—Ç—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è `DEBUG=true` –≤ docker-compose.yml
2. ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `timezone` –∏ `week_start_day`)
3. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `DigestService` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç preferences –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
5. ‚úÖ –ü–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω backend

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### –®–∞–≥ 1: –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ
–ù–∞–∂–º–∏—Ç–µ `F5` –∏–ª–∏ `Ctrl+R`

### –®–∞–≥ 2: –û—Ç–∫—Ä–æ–π—Ç–µ Daily Digest

–¢–µ–ø–µ—Ä—å –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```json
{
  "date_from": "2025-10-14T00:00:00",
  "date_to": "2025-10-14T23:59:59.999999",
  "news_count": ...,
  "categories": {...}
}
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Settings ‚Üí Digest Settings**
2. –ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ü–∏—é **"Timezone & Week Settings"**
3. –í—ã–±–µ—Ä–∏—Ç–µ:
   - **Timezone**: Europe/Moscow (–¥–ª—è –†–æ—Å—Å–∏–∏) –∏–ª–∏ –≤–∞—à —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å
   - **Week Start Day**: 
     - **Sunday** - –Ω–µ–¥–µ–ª—è –í—Å‚Üí–°–± (–∫–∞–∫ –≤ GitHub, –°–®–ê)
     - **Monday** - –Ω–µ–¥–µ–ª—è –ü–Ω‚Üí–í—Å (ISO 8601, –ï–≤—Ä–æ–ø–∞)
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ

## –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

### Daily Digest

**–ó–∞–ø—Ä–æ—Å:** GET `/api/v1/digest/daily`

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```json
{
  "date_from": "2025-10-14T17:33:38.417330",
  "date_to": "2025-10-14T17:33:38.417330",
  "news_count": 0
}
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```json
{
  "date_from": "2025-10-14T00:00:00",
  "date_to": "2025-10-14T23:59:59.999999",
  "news_count": 15,
  "categories": {...}
}
```

### Weekly Digest

**–ó–∞–ø—Ä–æ—Å:** GET `/api/v1/digest/weekly`

**–î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
```json
{
  "date_from": "2025-10-14T17:33:38.417330",
  "date_to": "2025-10-14T17:33:38.417330"
}
```

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (Sunday start):**
```json
{
  "date_from": "2025-10-12T00:00:00",  // –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
  "date_to": "2025-10-18T23:59:59.999999",  // –°—É–±–±–æ—Ç–∞
  "news_count": 87,
  "categories": {...}
}
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –†–∞—Å—á–µ—Ç –¥–∞—Ç –¥–ª—è Daily Digest

```python
# –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è –≤ —á–∞—Å–æ–≤–æ–º –ø–æ—è—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
now_user = datetime.now(pytz.timezone('Europe/Moscow'))  # –ù–∞–ø—Ä–∏–º–µ—Ä

# –ù–∞—á–∞–ª–æ –¥–Ω—è
date_from = now_user.replace(hour=0, minute=0, second=0, microsecond=0)

# –ö–æ–Ω–µ—Ü –¥–Ω—è  
date_to = now_user.replace(hour=23, minute=59, second=59, microsecond=999999)

# –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ UTC –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞ –∫ –ë–î
date_from_utc = date_from.astimezone(pytz.UTC)
date_to_utc = date_to.astimezone(pytz.UTC)
```

### –†–∞—Å—á–µ—Ç –¥–∞—Ç –¥–ª—è Weekly Digest

```python
# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏ (–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ –∏–ª–∏ –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫)
if week_start_day == 0:  # Sunday
    days_since_week_start = (now_user.weekday() + 1) % 7
else:  # Monday
    days_since_week_start = now_user.weekday()

# –ù–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏
week_start = now_user - timedelta(days=days_since_week_start)
date_from = week_start.replace(hour=0, minute=0, second=0)

# –ö–æ–Ω–µ—Ü –Ω–µ–¥–µ–ª–∏ (—á–µ—Ä–µ–∑ 6 –¥–Ω–µ–π)
week_end = now_user + timedelta(days=(6 - days_since_week_start))
date_to = week_end.replace(hour=23, minute=59, second=59)
```

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–¢–µ–ø–µ—Ä—å –≤ –ª–æ–≥–∞—Ö backend –≤—ã —É–≤–∏–¥–∏—Ç–µ:
```
2025-10-14 17:45:00.123 | INFO | Generating daily digest for user 7e0556e1-...
2025-10-14 17:45:00.124 | DEBUG | Period: daily, User TZ: UTC, Now UTC: 2025-10-14 17:45:00+00:00
2025-10-14 17:45:00.125 | DEBUG | Daily digest user TZ range: 2025-10-14 00:00:00 to 2025-10-14 23:59:59
2025-10-14 17:45:00.126 | DEBUG | Daily digest UTC range: 2025-10-14 00:00:00 to 2025-10-14 23:59:59
2025-10-14 17:45:00.127 | INFO | Date range for daily digest (timezone: UTC): 2025-10-14 00:00:00 to 2025-10-14 23:59:59 UTC
2025-10-14 17:45:00.234 | INFO | Digest generated: 15 news items
```

## –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å

1. **–û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞** –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend:**
   ```bash
   docker logs shot-news-backend --tail 50
   ```
3. **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞** (F12) –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–≤–µ—Ç API
4. **–ü—Ä–∏—à–ª–∏—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç** —Å –Ω–æ–≤–æ–π –æ—à–∏–±–∫–æ–π

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **DIGEST_DATE_LOGIC.md** - –ø–æ–¥—Ä–æ–±–Ω–∞—è —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- **DIGEST_UPDATE_SUMMARY.md** - –ø–æ–ª–Ω—ã–π –æ—Ç—á–µ—Ç –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
- **–ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø_–î–ê–ô–î–ñ–ï–°–¢–û–í.md** - –∫—Ä–∞—Ç–∫–∞—è —Å–≤–æ–¥–∫–∞ –Ω–∞ —Ä—É—Å—Å–∫–æ–º

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–î–∞–π–¥–∂–µ—Å—Ç—ã —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
- ‚úÖ Daily Digest - –Ω–æ–≤–æ—Å—Ç–∏ –∑–∞ —Ç–µ–∫—É—â–∏–π –¥–µ–Ω—å (00:00 - 23:59)
- ‚úÖ Weekly Digest - –Ω–æ–≤–æ—Å—Ç–∏ –∑–∞ —Ç–µ–∫—É—â—É—é –Ω–µ–¥–µ–ª—é (–í—Å-–°–± –∏–ª–∏ –ü–Ω-–í—Å)
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —á–∞—Å–æ–≤—ã—Ö –ø–æ—è—Å–æ–≤
- ‚úÖ –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–æ–µ –Ω–∞—á–∞–ª–æ –Ω–µ–¥–µ–ª–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ preferences

**–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ!** üöÄ

